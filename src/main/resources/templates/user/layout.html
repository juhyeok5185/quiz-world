<!doctype html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ê³µí†µ ë ˆì´ì•„ì›ƒ</title>
</head>
<body class="flex flex-col min-h-screen bg-gray-100">

<!-- Header -->
<header class="flex items-center justify-between px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white">
    <div id="backButton" class="text-2xl cursor-pointer" onclick="goBack();">â†</div> <!-- ë’¤ë¡œê°€ê¸° -->
    <h1 id="logoArea" class="text-xl font-bold"></h1> <!-- ì¤‘ì•™ ë¡œê³  -->
    <div id="menuButton" class="text-2xl cursor-pointer">â‰¡</div> <!-- í–„ë²„ê±° ë©”ë‰´ (ì‘ëŒ€ê¸° 3ê°œ) -->
</header>

<div id="adBanner" class="w-full bg-yellow-200 text-gray-800 text-center py-3">
    <span class="font-semibold">ğŸ”¥ ì§€ê¸ˆ ê°€ì…í•˜ë©´ 30% í• ì¸! ğŸ”¥</span>
</div>


<!-- ì „ì²´ í™”ë©´ íŒì—… -->
<!-- ì „ì²´ í™”ë©´ íŒì—… -->
<div id="fullScreenPopup" class="fixed inset-0 bg-white hidden flex flex-col z-50">
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <div class="w-full px-6 py-4 flex items-center">
        <button id="closePopup" class="text-2xl text-gray-700">â†</button> <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    </div>

    <!-- ì•Œë¦¼ | ì„¤ì • | ë¡œê·¸ì•„ì›ƒ (ì•„ì´ì½˜ ì¶”ê°€) -->
    <div class="w-full px-6 py-4 flex justify-around text-lg font-semibold text-gray-700">
        <div class="flex flex-col items-center">
            <span class="text-2xl">ğŸ””</span>
            <span>ì•Œë¦¼</span>
        </div>
        <div class="flex flex-col items-center">
            <span class="text-2xl">âš™ï¸</span>
            <span>ì„¤ì •</span>
        </div>
        <div class="flex flex-col items-center">
            <span class="text-2xl text-red-500">ğŸšª</span>
            <span class="text-red-500" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</span>
        </div>
    </div>

    <!-- ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ (ë†’ì´ ì¦ê°€) -->
    <div class="w-full">
        <div class="flex items-center justify-between px-4 h-16 cursor-pointer"
             onclick="location.href='/user/subject'">
            <span class="text-lg text-gray-800">ë‚´ ê³¼ëª© ë°”ë¡œê°€ê¸°</span>
            <span class="text-xl text-gray-500">â€º</span>
        </div>

        <div class="flex items-center justify-between px-4 h-16 border-t border-b cursor-pointer"
             onclick="location.href='#'">
            <span class="text-lg text-gray-800">ê³¼ëª© ê²€ìƒ‰í•˜ê¸°</span>
            <span class="text-xl text-gray-500">â€º</span>
        </div>
    </div>

    <!-- ë¹ˆ ê³µê°„ -->
    <div class="flex-grow bg-white"></div>
</div>


<!-- ì½˜í…ì¸  -->
<content class="flex-grow pt-0">
    <div layout:fragment="content"></div>
</content>

<script src="https://cdn.tailwindcss.com"></script>
<script src="/static/common/js/fetchUtils.js" type="application/javascript"></script>
<script src="/static/common/js/common.js" type="application/javascript"></script>
<script>
    let memberInfo = [];


    window.onload = function () {
        findMember()
        hideBackButton();
        makeAdLocalStorage();
    }

    function makeAdLocalStorage(){
        const keys = [
            'postCount',
            'getCount',
            'updateCount',
            'useModeCount'
        ];

        keys.forEach((key) => {
            if (localStorage.getItem(key) === null) {
                localStorage.setItem(key, '0'); // ìµœì´ˆ ì‹¤í–‰ì¼ ë•Œë§Œ ì„¸íŒ…ë¨
            }
        });
    }

    function increaseAdCount(key) {
        if(memberInfo.subscribeYn) return
        const value = parseInt(localStorage.getItem(key) || '0');
        localStorage.setItem(key, (value + 1).toString());
        switch (key) {
            case 'postCount': // save
                if (value >= 15) { alert('ê´‘ê³ '); localStorage.setItem(key, '0'); }
                break;
            case 'getCount': // getList
                if (value >= 8) { alert('ê´‘ê³ '); localStorage.setItem(key, '0'); }
                break;
            case 'updateCount': // ìˆ˜ì •
                if (value >= 30) { alert('ê´‘ê³ '); localStorage.setItem(key, '0'); }
                break;
            case 'useModeCount': // ì¡°íšŒë§Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ
                if (value >= 50) { alert('ê´‘ê³ '); localStorage.setItem(key, '0'); }
                break;
        }
    }

    async function findMember(){
        const url = `/api/members`;
        memberInfo = await fetchGet(url);
        checkSubscribe();
    }

    function checkSubscribe(){
        if(memberInfo.subscribeYn){
            find('#adBanner').classList.add("hidden");
        }
    }

    function hideBackButton(){
        const url = window.location.pathname;
        if (url === "/user/main") {
            document.querySelector("#backButton").classList.add("hidden"); // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìˆ¨ê¹€
        }
    }

    function goBack(){
        window.history.back();
    }

    // íŒì—… ì—´ê¸°
    document.querySelector("#menuButton").addEventListener("click", function () {
        document.querySelector("#fullScreenPopup").classList.remove("hidden");
        document.body.classList.add("overflow-hidden");  // ë°°ê²½ ìŠ¤í¬ë¡¤ ë§‰ê¸°
    });

    // íŒì—… ë‹«ê¸°
    document.querySelector("#closePopup").addEventListener("click", function () {
        document.querySelector("#fullScreenPopup").classList.add("hidden");
        document.body.classList.remove("overflow-hidden");  // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µêµ¬
    });

    async function logout() {
        await fetchPostByLogout("/logout")
        location.href = "/";
    }
</script>

<th:block layout:fragment="script"></th:block>
</body>
</html>
